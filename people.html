<head>
    <title>people</title>
    <meta charset="utf-8">
</head>

<body>
    <div class="navbar navbar-fixed-top navbar-inverse">
        <div class="navbar-inner">
            <div class="container">
                {{> navbar}}
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            {{#if currentUser}}
            <div class="span3">
                <ul class="nav nav-list people">
                    {{> people}}
                </ul>
            </div>
            <div class="span9">
                {{>selectedperson}}
            </div>
            {{else}}
            <div class="span12">
                {{>welcome}}
            </div>
            {{/if}}
        </div>
    </div>
    <div class="navbar navbar-fixed-bottom footer">
        <div class="navbar-inner">
            <div class="container">
                <p class="light-keys">
                <span><kbd>⌘</kbd> + <kbd>⏎</kbd> Save note</span>
                <span><kbd>c</kbd> Focus comment field</span>
                <span><kbd>a</kbd> Focus find or create person field</span>
                <span><kbd>⌘</kbd> + <kbd>▲/▼</kbd> Change person</span>
                </p>
            </div>
        </div>
    </div>
    {{> modals}}
</body>

<template name="people">
{{#each people}}
    {{> person}}
{{/each}}
</template>

<template name="person">
<li class="person {{selected_class}}">
<a href="#">
    <i class="icon-chevron-right pull-right"></i>
    {{#if note_count}}
    <span class="badge pull-right">{{note_count}}</span>
    {{/if}}
    {{name}}
</a>
</li>
</template>

<template name="person_note">
<dt>
{{formatdate date}}
</dt>
<dd class="clearfix" style="margin-bottom: 10px">
<div class="btn-group pull-right toolbox">
    <a class="btn btn-mini edit"><i class="icon-pencil"></i></a>
    <a class="btn btn-mini btn-danger"><i class="icon-trash"></i></a>
</div>
<div class="form-ahead">
{{#markdown}}
{{text}}
{{/markdown}}
</div>
<div class="labels">{{#each tags}}<span class="label label-info pull-right">{{this}}</span>{{/each}}</div>
<form class="form-behind hide">
    <textarea name="edit_note" class="span6 edit-note" rows="5">{{origText}}</textarea>
    <a class="btn save-note cmd-enter"><i class="icon-comment"></i> Save</a>
</div>
</dd>
</template>
<template name="person_action">
<dt class="action pri-{{pri}}">
{{#unless done}}
<div class="btn-group pull-right">
    <a class="btn btn-mini complete"><i class="icon-ok"></i></a>
</div>
{{/unless}}
</dt>
<dd class="action pri-{{pri}} {{#if done}}completed{{/if}}">
<p>
<span class="text">{{text}}</span>
{{#if done}} <span class="muted">at {{formatdate done}}</span>{{/if}}
<a class="toolbox inline btn btn-mini trash{{#unless done}} btn-danger{{/unless}}"><i class="icon-trash"></i></a>
</p>
</dd>
</template>
<template name="selectedperson">
{{#if selected_person}}
<h1>{{selected_person.name}}
    <div class="btn-toolbar pull-right clearfix">
        <div class="btn-group">
            <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                Change group
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                {{>groups}}
            </ul>
        </div>
        <button type="button" class="btn btn-danger remove-person" data:user="{{selected_person._id}}">
            <i class="icon-trash"></i>
        </button>
    </div>
</h1>

<dl class="dl-horizontal actions">
    {{#each selected_person.actions}}
        {{>person_action}}
    {{/each}}
</dl>
<dl class="dl-horizontal">
    {{#each selected_person.notes}}
        {{>person_note}}
    {{/each}}
</dl>

<form class="form-horizontal">
    <legend>Add note</legend>
    <div class="control-group">
        <label for="new_note" class="control-label">New note</label>
        <div class="controls">
            <textarea class="span6" name="new_note" id="new_note" rows="5"></textarea>
        </div>
    </div>
    <div class="controls-group">
        <div class="controls">
            <a href="#" class="btn cmd-enter"><i class="icon-comment"></i> Add note</a>
        </div>
    </div>
</form>
{{/if}}
</template>
<template name="groups">
{{#each groups}}
    {{> group}}
{{/each}}
</template>
<template name="group">
<li><a class="group {{selected_class}}" href="#">
    {{#if selected_class}}<i class="icon-ok pull-right"></i>{{/if}}
    {{name}}</a></li>
</template>
